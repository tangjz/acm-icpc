# Write your MySQL query statement below
with cte1 as (select customer_id, transaction_date as cur_date, lag(transaction_date, 1) over(partition by customer_id order by transaction_date asc) as pre_date, amount as cur_cnt, lag(amount, 1) over(partition by customer_id order by transaction_date asc) as pre_cnt from Transactions), cte2 as (select customer_id, cur_date from cte1 where pre_date is not null and datediff(cur_date, pre_date) = 1 and pre_cnt < cur_cnt), cte3 as (select customer_id, cur_date, row_number() over(partition by customer_id order by cur_date asc) as rnk from cte2), cte4 as (select customer_id, date_sub(min(cur_date), INTERVAL 1 DAY) as start, max(cur_date) as end, date_sub(cur_date, INTERVAL rnk DAY) as sort_key from cte3 group by customer_id, sort_key having count(customer_id) >= 2) select customer_id, start as consecutive_start, end as consecutive_end from cte4 order by customer_id;
