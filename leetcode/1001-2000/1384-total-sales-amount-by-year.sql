# Write your MySQL query statement below
select cast(A.product_id as char) as product_id, A.product_name, cast(T4.report_year as char) as report_year, sum(B.average_daily_sales * (datediff(least(B.period_end, T4.report_end), greatest(B.period_start, T4.report_start)) + 1)) as total_amount from (Product A inner join Sales B on A.product_id = B.product_id) inner join (select (@low + T3.id - 1) as report_year, concat(@low + T3.id - 1, '-01-01') as report_start, concat(@low + T3.id - 1, '-12-31') as report_end from (select @low := (select min(year(period_start)) from Sales)) T1, (select @upp := (select max(year(period_end)) from Sales)) T2, json_table(concat('[{}', repeat(',{}', @upp - @low), ']'), '$[*]' columns(id for ordinality)) T3) T4 on T4.report_start <= B.period_end and B.period_start <= T4.report_end group by A.product_id, T4.report_year order by product_id, report_year;
